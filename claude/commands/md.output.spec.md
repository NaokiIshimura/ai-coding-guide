---
allowed-tools: Write, Read, Bash(git:*), Bash(TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M'), Glob, Grep
description: 実装計画作成（requirements/design/tasks.md）を出力する
---

## コンテキスト

- 現在のブランチ: !`git branch --show-current`
- 現在のディレクトリ: !`pwd`
- 現在の日時（日本時間）: !`TZ='Asia/Tokyo' date '+%Y-%m-%d %H:%M:%S'`

## タスク

現在までの作業状況や調査結果を整理して、実装計画（requirements/design/tasks.md）として出力してください。

### 実施手順

1. **出力内容の確認**
   - ユーザーに以下を確認：
     - チケット番号またはタスク識別子（ブランチ名から推測可能な場合は自動取得）
     - 出力先ディレクトリ（デフォルト: `.claude/tasks/<チケット番号>/`）

2. **情報の収集と整理**
   - 現在の作業状況を分析
   - 関連するファイルや変更内容を確認
   - git差分がある場合は変更内容を要約
   - 必要に応じて既存のドキュメントや設定を参照

3. **タイムスタンプの生成**
   - 日本時間のタイムスタンプを取得: `TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M'`
   - フォーマット: `YYYY_MMDD_HHMM`
   - 例: 2025年01月02日03時04分の場合 → `2025_0102_0304`

4. **実装計画ドキュメントの作成**
   以下の3つのドキュメントを作成：

   **a) 仕様書（requirements.md）**
   ```markdown
   # 仕様書: [タイトル]

   ## 概要
   - プロジェクト/機能の目的
   - 背景と課題

   ## 要件
   ### 機能要件
   - 必須機能のリスト
   - 各機能の詳細説明

   ### 非機能要件
   - パフォーマンス要件
   - セキュリティ要件
   - 互換性要件

   ## 受け入れ条件
   - 完了の定義
   - 検証方法

   ## 制約事項
   - 技術的制約
   - スコープ外の事項

   ## 参考情報
   - 関連ドキュメント
   - 外部リンク
   ```

   **b) 設計書（design.md）**
   ```markdown
   # 設計書: [タイトル]

   ## システム構成
   - アーキテクチャ概要
   - コンポーネント構成

   ## データ設計
   - データモデル
   - スキーマ定義

   ## API設計
   - エンドポイント一覧
   - リクエスト/レスポンス仕様

   ## UI/UX設計
   - 画面設計
   - ユーザーフロー

   ## セキュリティ設計
   - 認証・認可
   - データ保護

   ## エラーハンドリング
   - エラーケース
   - 対処方法

   ## 技術スタック
   - 使用技術
   - ライブラリ/フレームワーク

   ## 実装上の注意点
   - 重要な考慮事項
   - ベストプラクティス
   ```

   **c) タスクリスト（tasks.md）**
   ```markdown
   # タスクリスト: [タイトル]

   ## タスク概要
   - 全体の作業方針
   - 見積もり工数

   ## タスク一覧

   ### 1. [タスク名]
   - **優先度**: 高/中/低
   - **工数見積**: XX時間
   - **担当**: TBD
   - **詳細**:
     - 実施内容の説明
     - 必要な作業項目
   - **チェックリスト**:
     - [ ] サブタスク1
     - [ ] サブタスク2

   ### 2. [タスク名]
   - **優先度**: 高/中/低
   - **工数見積**: XX時間
   - **担当**: TBD
   - **詳細**:
     - 実施内容の説明
   - **チェックリスト**:
     - [ ] サブタスク1
     - [ ] サブタスク2

   ## 依存関係
   - タスク間の依存関係
   - 実施順序

   ## リスク管理
   - 想定されるリスク
   - 対応策

   ## テスト計画
   - テスト項目
   - テスト方法

   ## デプロイ計画
   - デプロイ手順
   - ロールバック方針
   ```

5. **ファイル名の生成**
   タイムスタンプを含むファイル名を生成：
   - `YYYY_MMDD_HHMM_requirements.md`
   - `YYYY_MMDD_HHMM_design.md`
   - `YYYY_MMDD_HHMM_tasks.md`

6. **ファイルの出力**
   - `.claude/tasks/<チケット番号>/` ディレクトリに出力
   - ディレクトリが存在しない場合は作成
   - 既存ファイルとの重複をチェック（タイムスタンプで区別）

7. **出力完了の報告**
   - 出力した各ファイルのパス
   - 各ファイルの主要なセクション数
   - 内容の要約

### 注意事項

- **機密情報の保護**: パスワード、APIキー、トークンなどの機密情報は出力しない
- **タイムスタンプ**: 必ず日本時間のタイムスタンプを使用（`TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M'`）
- **構造化**: 読みやすく構造化されたフォーマットを使用
- **一貫性**: 他のドキュメントと一貫性のある形式を使用
- **バージョン管理**: 新しいタイムスタンプのファイルとして保存し、既存ファイルは上書きしない
- **ファイル末尾**: 全てのファイルの末尾に空行を追加

### 期待される成果

1. 要件が明確に定義された仕様書
2. 技術的に実現可能な設計書
3. 実行可能なタスクリスト
4. ドキュメント間の一貫性と整合性
5. 後から参照・更新しやすい構造
