---
allowed-tools: Write, Read, Bash(git:*), Bash(TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'), Glob, Grep, Task
description: 実装計画作成（requirements/design/tasks.md）を出力する
---

## コンテキスト

- 現在のブランチ: !`git branch --show-current`
- 現在のディレクトリ: !`pwd`
- 現在の日時（日本時間）: !`TZ='Asia/Tokyo' date '+%Y-%m-%d %H:%M:%S'`

## タスク

現在までの作業状況や調査結果を整理して、実装計画（requirements/design/tasks.md）として出力してください。

### 実施手順

1. **出力内容の確認**
   - ユーザーに以下を確認：
     - チケット番号またはタスク識別子（ブランチ名から推測可能な場合は自動取得）
     - 出力先ディレクトリ（デフォルト: `.claude/plans/<チケット番号>/`）

2. **情報の収集と整理**
   - 現在の作業状況を分析
   - 関連するファイルや変更内容を確認
   - git差分がある場合は変更内容を要約
   - 必要に応じて既存のドキュメントや設定を参照

3. **出力先ディレクトリの作成**
   - `.claude/plans/<チケット番号>/` ディレクトリを作成（存在しない場合）
   - チケット番号が不明な場合は `.claude/plans/tmp/` を使用

4. **実装計画ドキュメントの作成**
   - Taskツールで `spec-writer` エージェントを呼び出し、以下の3つのドキュメントを作成：
     1. 仕様書（requirements.md）
     2. 設計書（design.md）
     3. タスクリスト（tasks.md）
   - 呼び出し時に以下の情報を渡す：
     - チケット番号またはタスク識別子
     - 収集した作業状況・調査結果のサマリー
     - 出力先ディレクトリ

5. **ファイル名の生成**
   - タイムスタンプを含むファイル名を生成：
     - `YYYY_MMDD_HHMM_SS_requirements.md`
     - `YYYY_MMDD_HHMM_SS_design.md`
     - `YYYY_MMDD_HHMM_SS_tasks.md`
   - タイムスタンプは日本時間: `TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'`

6. **出力完了の報告**
   - 出力した各ファイルのパス
   - 各ファイルの主要なセクション数
   - 内容の要約

### 注意事項

- **機密情報の保護**: パスワード、APIキー、トークンなどの機密情報は出力しない
- **タイムスタンプ**: 必ず日本時間のタイムスタンプを使用（`TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'`）
- **構造化**: 読みやすく構造化されたフォーマットを使用
- **一貫性**: 他のドキュメントと一貫性のある形式を使用
- **バージョン管理**: 新しいタイムスタンプのファイルとして保存し、既存ファイルは上書きしない
- **ファイル末尾**: 全てのファイルの末尾に空行を追加

### 期待される成果

1. 要件が明確に定義された仕様書
2. 技術的に実現可能な設計書
3. 実行可能なタスクリスト
4. ドキュメント間の一貫性と整合性
5. 後から参照・更新しやすい構造
