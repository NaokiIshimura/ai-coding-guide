---
allowed-tools: Write, Read, Bash(git:*), Bash(TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'), Glob, Grep
description: 実行計画（plan.md）を出力する
---

## コンテキスト

- 現在のブランチ: !`git branch --show-current`
- 現在のディレクトリ: !`pwd`
- 現在の日時（日本時間）: !`TZ='Asia/Tokyo' date '+%Y-%m-%d %H:%M:%S'`

## タスク

現在までの作業状況や調査結果を整理して、実行計画（plan.md）として出力してください。

### 実施手順

1. **出力内容の確認**
   - ユーザーに以下を確認：
     - 実行計画のタイトル（タスクやプロジェクトの名称）
     - チケット番号またはタスク識別子（ブランチ名から推測可能な場合は自動取得）
     - 出力先ディレクトリ（デフォルト: `.claude/plans/<チケット番号>/`）

2. **情報の収集と整理**
   - 現在の会話履歴から作業状況を分析
   - 関連するファイルや変更内容を確認
   - git差分がある場合は変更内容を要約
   - 必要に応じて既存のドキュメントや設定を参照
   - 既存のplan.md、requirements.md、design.md、tasks.mdがあれば参照

3. **出力先ディレクトリの作成**
   - `.claude/plans/<チケット番号>/` ディレクトリを作成（存在しない場合）
   - チケット番号が不明な場合は `.claude/plans/tmp/` を使用

4. **タイムスタンプの生成**
   - 日本時間でタイムスタンプを生成：
     ```bash
     TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'
     ```

5. **plan.mdの作成**
   - 標準構造に従ってplan.mdを作成
   - セクション構成：
     1. **タイトル**: 実行計画の名称
     2. **概要**: タスクの目的・背景、期待される成果の簡潔な説明
     3. **前提条件**: 既存の成果物、技術スタック、制約事項、必要なリソース
     4. **実装ステップ**: 各ステップに以下を含める
        - ステップ名と絵文字（🔍調査、📝作成、🚀実行、✅確認など）
        - **目的**: このステップで達成すること
        - **タスク**: 具体的なタスクリスト
        - **成果物**: 期待される成果物
     5. **想定される課題と対策**:
        - 各課題の詳細
        - 対策のリスト
     6. **タイムライン**: ステップごとの予想時間を表形式で記載
     7. **次のアクション**: 最初に取り組むべき項目をリスト化
     8. **備考**:
        - 作成日時（日本時間、YYYY年MM月DD日 HH:MM:SS形式）
        - 作成者: Claude Code
        - 関連ファイルのパス

   - ファイル名: `YYYY_MMDD_HHMM_SS_plan.md`
   - 出力先: `.claude/plans/<チケット番号>/` または `.claude/plans/tmp/`

6. **ファイル出力**
   - Writeツールでplan.mdを出力
   - ファイル末尾に必ず空行を追加

7. **出力完了の報告**
   - 出力したファイルのパス
   - plan.mdの概要（ステップ数、想定時間など）
   - 次のアクション項目

### plan.md の標準構造

```markdown
# [タイトル]

## 概要
- タスクの目的・背景
- 期待される成果の簡潔な説明

## 前提条件
- 既存の成果物
- 技術スタック
- 制約事項
- 必要なリソース

## 実装ステップ

### ステップ1: [ステップ名] [絵文字]

**目的**: [このステップで達成すること]

**タスク**:
1. [具体的なタスク1]
2. [具体的なタスク2]
...

**成果物**:
- [期待される成果物]

### ステップ2: [ステップ名] [絵文字]

（同様の構造を繰り返し）

## 想定される課題と対策

### 課題1: [課題名]

**課題**: [問題の詳細]

**対策**:
- [対策1]
- [対策2]

### 課題2: [課題名]

（同様の構造を繰り返し）

## タイムライン

| ステップ | 予想時間 | 備考 |
|---------|---------|------|
| 1. ... | XX分 | ... |
| 2. ... | XX分 | ... |
| **合計** | **約XX分** | |

## 次のアクション

1. [最初にやるべきこと]
2. [次にやるべきこと]
3. [最後にやるべきこと]

## 備考

- [追加の注意事項]
- [参考情報]

---

**作成日時**: YYYY年MM月DD日 HH:MM:SS
**作成者**: Claude Code
**関連ファイル**:
- [関連ファイルのパス]
```

### 注意事項

- **機密情報の保護**: パスワード、APIキー、トークンなどの機密情報は出力しない
- **タイムスタンプ**: 必ず日本時間のタイムスタンプを使用（`TZ='Asia/Tokyo' date '+%Y_%m%d_%H%M_%S'`）
- **構造化**: 読みやすく構造化されたフォーマットを使用
- **実行可能性**: 各ステップが実行可能で、明確な完了条件を持つようにする
- **バージョン管理**: 新しいタイムスタンプのファイルとして保存し、既存ファイルは上書きしない
- **ファイル末尾**: ファイルの末尾に空行を追加
- **絵文字の使用**: ステップや課題に適切な絵文字を付けて視認性を向上
  - 🔍 調査・分析
  - 📝 作成・記述
  - 🚀 実行・実装
  - ✅ 確認・検証
  - ⚠️ 注意・警告
  - 📊 データ・分析
- **日本語**: plan.mdは日本語で記述
- **ステップの粒度**: 1ステップは15分〜1時間程度の作業を目安にする
- **ステップ数**: 3〜10個程度を目安にする

### 期待される成果

1. 実行可能な計画として整理されたplan.md
2. 各ステップの目的と成果物が明確
3. 想定される課題とその対策が事前に整理されている
4. タイムラインで全体の所要時間が把握できる
5. 次のアクションが明確で、すぐに作業を開始できる
6. 後から参照・更新しやすい構造

### 使い分けガイド

**`/md.output.plan` を使う場合**:
- 軽量な実行計画で十分（単一ファイル: plan.md）
- 個人作業やプロトタイピング
- 短期タスクやシンプルな実装
- 既にrequirements/design.mdがあり、実行計画のみ欲しい

**`/md.output.spec` を使う場合**:
- 正式な実装計画が必要（3ファイル: requirements/design/tasks.md）
- チーム共有用の詳細な仕様書・設計書が必要
- 複雑な機能の実装で、要件・設計・タスクを分離したい
