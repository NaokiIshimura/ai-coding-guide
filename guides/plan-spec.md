# Plan and Spec

## AIへの指示
実行計画と仕様書の出力について以下のルールを厳守してください。

### 実装開始前の必須作業
- **重要**: 計画・仕様ファイル（plan.md, requirements.md, design.md, tasks.md）は実装を開始する前に必ず作成してください
- **重要**: コードを書き始める前に、まず要件を整理し、設計を行い、タスクを分解してください

### ファイル出力の基本ルール
- **重要**: 全ての計画・仕様ファイルは`.claude/tasks/`配下に出力してください
- **重要**: ファイル名には必ずタイムスタンプを付けてください（YYYY_MMDD_HHMM_SS形式、日本時間）
- **重要**: ファイルの内容は日本語で記述してください
- ファイル末尾は必ず空行で終わるようにしてください

### 出力先ディレクトリ
- チケット番号がある場合: `.claude/tasks/<チケット番号>/`
- チケット番号がない場合: `.claude/tasks/tmp/`

---

## 実行計画 (plan.md)

### 以下の場合、plan.mdを出力してください
- ユーザーから「計画を立てて」「プランを作成して」と指示された時
- 複数ステップの実装タスクを開始する前
- EnterPlanModeツールを使用した時
- 要件分析が完了し、実装方針を決定した時

### ファイル名形式
```
.claude/tasks/<ticket-or-tmp>/YYYY_MMDD_HHMM_SS_plan.md
```

### 含めるべき内容
1. 実装の概要
2. ステップバイステップの実行計画
3. 関連する重要ファイル
4. 検証手順
5. 注意点・リスク

---

## 仕様書 (requirements.md, design.md, tasks.md)

### requirements.md - 要件定義書

#### 以下の場合、requirements.mdを出力してください
- ユーザー要件をヒアリング・整理した時
- JIRA/GitHub Issueから要件を抽出した時
- 機能仕様を文書化する時

#### ファイル名形式
```
.claude/tasks/<ticket-or-tmp>/YYYY_MMDD_HHMM_SS_requirements.md
```

#### 含めるべき内容
1. 機能要件
2. 非機能要件
3. ユースケース
4. 受け入れ基準
5. 制約事項

---

### design.md - 設計書

#### 以下の場合、design.mdを出力してください
- 技術設計・アーキテクチャを決定した時
- データモデルを設計した時
- API仕様を定義した時

#### ファイル名形式
```
.claude/tasks/<ticket-or-tmp>/YYYY_MMDD_HHMM_SS_design.md
```

#### 含めるべき内容
1. システムアーキテクチャ
2. 技術選定と理由
3. データモデル
4. API仕様
5. セキュリティ考慮事項

---

### tasks.md - タスクリスト

#### 以下の場合、tasks.mdを出力してください
- 実装タスクを分解した時
- スプリント計画を立てた時
- 作業の優先順位を決定した時

#### ファイル名形式
```
.claude/tasks/<ticket-or-tmp>/YYYY_MMDD_HHMM_SS_tasks.md
```

#### 含めるべき内容
1. 優先順位付きタスクリスト
2. 各タスクの説明
3. タスク間の依存関係
4. 推定工数・複雑度
5. 担当者（該当する場合）

---

## 例

### チケット番号がある場合
```
.claude/tasks/ABC-123/2026_0118_1030_45_plan.md
.claude/tasks/ABC-123/2026_0118_1030_50_requirements.md
.claude/tasks/ABC-123/2026_0118_1031_15_design.md
.claude/tasks/ABC-123/2026_0118_1031_30_tasks.md
```

### チケット番号がない場合
```
.claude/tasks/tmp/2026_0118_1030_45_plan.md
.claude/tasks/tmp/2026_0118_1030_50_requirements.md
.claude/tasks/tmp/2026_0118_1031_15_design.md
.claude/tasks/tmp/2026_0118_1031_30_tasks.md
```

### 実装フロー例

1. ユーザーから「ログイン機能を追加して」とリクエスト
2. **requirements.md** を作成: ログイン機能の要件を整理
3. **design.md** を作成: 認証方式（JWT）、DB設計、API設計
4. **tasks.md** を作成: 実装タスクを分解（DB migration, API実装, UI実装, テスト）
5. **plan.md** を作成: 全体の実行計画とステップ
6. tasks.mdに従って実装を開始

---

## 重要な注意点

- **必須**: ファイル名には日本時間のタイムスタンプを使用してください
- **必須**: 全てのファイルは`.claude/tasks/`配下に出力してください
- **推奨**: 大規模な機能追加の場合は、requirements → design → tasks → plan の順で作成すると効果的です
- **推奨**: 既存のファイルがある場合は、新しいタイムスタンプで別ファイルとして作成し、履歴を保持してください
- ファイル出力後は、ユーザーにファイルパスを通知してください
